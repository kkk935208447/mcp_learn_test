MCP StreamableHTTP è¿œç¨‹è°ƒç”¨æ¶æ„æµç¨‹å›¾ (æ–‡æœ¬ç‰ˆ)
=====================================================

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        MCP StreamableHTTP è¿œç¨‹è°ƒç”¨æµç¨‹å›¾                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç¬¬ä¸€å±‚ï¼šç”¨æˆ·äº¤äº’å±‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ç”¨æˆ·è¾“å…¥æŸ¥è¯¢   â”‚ â†â”€â”€ ä¾‹å¦‚ï¼š"æŸ¥è¯¢å­¦ç”Ÿä¿¡æ¯è¡¨ä¸­æ•°æ®"
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
ç¬¬äºŒå±‚ï¼šMCPå®¢æˆ·ç«¯å±‚ (clientChatTest.py / mysqlMCPServerTest.py)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  LLMClient  â”‚    â”‚ChatSession  â”‚    â”‚ streamablehttp_client            â”‚  â”‚
â”‚  â”‚             â”‚    â”‚             â”‚    â”‚ - HTTPæµå¼è¿æ¥                   â”‚  â”‚
â”‚  â”‚ - LLMè°ƒç”¨    â”‚â—„â”€â”€â–ºâ”‚ - ä¼šè¯ç®¡ç†   â”‚â—„â”€â”€â–ºâ”‚ - è¯»å†™æµ read/write_stream       â”‚  â”‚
â”‚  â”‚ - JSONè§£æ   â”‚    â”‚ - å·¥å…·æ‰§è¡Œ   â”‚    â”‚ - å¼‚æ­¥è¿æ¥ç®¡ç†                   â”‚  â”‚
â”‚  â”‚ - å“åº”å¤„ç†   â”‚    â”‚ - èµ„æºè¯»å–   â”‚    â”‚                                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼ Streamable HTTP è¿æ¥ (http://127.0.0.1:8000/mcp)
ç¬¬ä¸‰å±‚ï¼šStreamableHTTP æœåŠ¡å™¨å±‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  FastAPI    â”‚    â”‚  Starlette                                         â”‚  â”‚
â”‚  â”‚ (fastapi_   â”‚    â”‚ (streamablehttpServer.py)                          â”‚  â”‚
â”‚  â”‚ streamable  â”‚    â”‚ - Starlette app/ASGI                               â”‚  â”‚
â”‚  â”‚ http_server â”‚    â”‚ - Mount /mcp è·¯ç”±                                  â”‚  â”‚
â”‚  â”‚ .py)        â”‚    â”‚ - handle_streamable_http                           â”‚  â”‚
â”‚  â”‚ - FastAPI   â”‚    â”‚ - ç”Ÿå‘½å‘¨æœŸç®¡ç† lifespan                             â”‚  â”‚
â”‚  â”‚   app       â”‚    â”‚                                                   â”‚  â”‚
â”‚  â”‚ - Mount /mcpâ”‚    â”‚                                                   â”‚  â”‚
â”‚  â”‚ - ç”Ÿå‘½å‘¨æœŸ  â”‚    â”‚                                                   â”‚  â”‚
â”‚  â”‚   lifespan  â”‚    â”‚                                                   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚         â”‚                        â”‚                                           â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                           â”‚
â”‚                       â–¼                                                      â”‚
â”‚        StreamableHTTPSessionManager.handle_request                            â”‚
â”‚        - ç»Ÿä¸€å¤„ç†æµå¼HTTPè¯·æ±‚ï¼Œåè®®è§£åŒ…ã€ä¼šè¯ç®¡ç†                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼ MCPåè®®é€šä¿¡
ç¬¬å››å±‚ï¼šMySQL MCPæœåŠ¡å™¨å±‚ (mysqlMCPServer.py)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚list_resourcesâ”‚   â”‚read_resource â”‚    â”‚           call_tool             â”‚  â”‚
â”‚  â”‚ - è¡¨åˆ—è¡¨è·å– â”‚    â”‚ - è¡¨æ•°æ®è¯»å– â”‚    â”‚ - SQLè¯­å¥æ‰§è¡Œ                   â”‚  â”‚
â”‚  â”‚ - èµ„æºæè¿°  â”‚    â”‚ - CSVæ ¼å¼åŒ–  â”‚    â”‚ - ç»“æœå¤„ç†                      â”‚  â”‚
â”‚  â”‚ - URIç”Ÿæˆ   â”‚    â”‚ - é”™è¯¯å¤„ç†   â”‚    â”‚ - äº‹åŠ¡ç®¡ç†                      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼ SQLæŸ¥è¯¢
ç¬¬äº”å±‚ï¼šæ•°æ®åº“å±‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                MySQL æ•°æ®åº“                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚  â”‚ students_info   â”‚              â”‚ students_score  â”‚                       â”‚
â”‚  â”‚ - id           â”‚              â”‚ - id           â”‚                       â”‚
â”‚  â”‚ - name         â”‚              â”‚ - student_id   â”‚                       â”‚
â”‚  â”‚ - age          â”‚              â”‚ - subject      â”‚                       â”‚
â”‚  â”‚ - class        â”‚              â”‚ - score        â”‚                       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

è¯¦ç»†æ•°æ®æµå‘åˆ†æï¼š

1. è¯·æ±‚æµå‘ (Request Flow):
   ç”¨æˆ·æŸ¥è¯¢ â†’ ChatSession.start() â†’ LLMClient.get_response() â†’ 
   LLMåˆ†æ â†’ JSONå·¥å…·è°ƒç”¨ â†’ Server.execute_tool() â†’ 
   streamablehttp_client å‘é€ â†’ StreamableHTTPSessionManager.handle_request() â†’ 
   MCPåè®®è½¬å‘ â†’ mysqlMCPServer.call_tool() â†’ 
   MySQLæ•°æ®åº“æŸ¥è¯¢

2. å“åº”æµå‘ (Response Flow):
   MySQLæŸ¥è¯¢ç»“æœ â†’ TextContentæ ¼å¼åŒ– â†’ 
   MCPå“åº” â†’ StreamableHTTPSessionManageræµå¼ä¼ è¾“ â†’ 
   ClientSessionæ¥æ”¶ â†’ ChatSession.process_llm_response() â†’ 
   LLMClientäºŒæ¬¡å¤„ç† â†’ è‡ªç„¶è¯­è¨€å“åº” â†’ ç”¨æˆ·

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

å…³é”®æŠ€æœ¯ç‚¹ï¼š

ğŸ”¹ Streamable HTTP åè®®ç‰¹ç‚¹:
  - HTTPé•¿è¿æ¥ï¼Œæ”¯æŒæµå¼æ•°æ®ä¼ è¾“
  - ç»Ÿä¸€ASGIåè®®ï¼Œæ”¯æŒFastAPI/Starletteç­‰å¤šç§æ¡†æ¶
  - å•å‘/åŒå‘æµï¼Œä½å»¶è¿Ÿ

ğŸ”¹ MCPåè®®å®ç°:
  - èµ„æºç®¡ç†ã€å·¥å…·ç®¡ç†ã€ä¼šè¯ç®¡ç†
  - å¼‚æ­¥å¤„ç†ï¼Œasync/awaitå…¨é“¾è·¯

ğŸ”¹ å¼‚å¸¸å¤„ç†æœºåˆ¶:
  - è¿æ¥é‡è¯•ã€èµ„æºæ¸…ç†ã€é”™è¯¯ä¼ æ’­ã€ä¼˜é›…å…³é—­

ğŸ”¹ é…ç½®ç®¡ç†:
  - ç¯å¢ƒå˜é‡ã€JSONé…ç½®ã€åŠ¨æ€åŠ è½½

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

å…¸å‹äº¤äº’ç¤ºä¾‹ï¼š

ç”¨æˆ·: "æŸ¥è¯¢å­¦ç”Ÿä¿¡æ¯è¡¨ä¸­æ•°æ®"
  â†“
LLMåˆ†æ: {"tool": "execute_sql", "arguments": {"query": "SELECT * FROM students_info LIMIT 100"}}
  â†“
MCPæ‰§è¡Œ: SQLæŸ¥è¯¢ â†’ CSVç»“æœ
  â†“
LLMè½¬æ¢: "ä»¥ä¸‹æ˜¯å­¦ç”Ÿä¿¡æ¯è¡¨ä¸­çš„æ•°æ®ï¼šåŒ…å«å­¦ç”Ÿå§“åã€å¹´é¾„ã€ç­çº§ç­‰ä¿¡æ¯..."
  â†“
ç”¨æˆ·çœ‹åˆ°: è‡ªç„¶è¯­è¨€æ ¼å¼çš„æŸ¥è¯¢ç»“æœ

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• 